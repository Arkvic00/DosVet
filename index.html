<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D BudPro TITANIUM</title>
    
    <!-- Configuraci贸n PWA para Android/iOS -->
    <meta name="theme-color" content="#0f172a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BudPro 3D">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiM0QgQnVkUHJvIiwiYmFja2dyb3VuZF9jb2xvciI6IiMwZjE3MmEiLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsInRoZW1lX2NvbG9yIjoiIzA2YjZkNCIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2Nkbbi5pY29uYXJjaGl2ZS5jb20vaWNvbnMvZ29vZ2xlL25vdG8tZW1vamktb2JqZWN0cy81MTIvNjI4NzgtcHJpbnRlci1pY29uLnBuZyIsInNpemVzIjoiNTEyeDUxMiIsInR5cGUiOiJpbWFnZS9wbmcifV19">

    <!-- React & Tools -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;500;700&display=swap');
        
        :root {
            --primary: #06b6d4; 
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #e2e8f0;
        }

        .theme-oled { --bg-color: #000000; --card-bg: #121212; }
        .theme-halloween { --primary: #f97316; }
        .theme-christmas { --primary: #ef4444; }
        
        body {
            background-color: var(--bg-color);
            font-family: 'Rajdhani', sans-serif;
            color: var(--text-main);
            transition: background-color 0.5s ease;
            overscroll-behavior: none;
        }
        
        .font-cyber { font-family: 'Orbitron', sans-serif; }
        .neon-text { text-shadow: 0 0 5px var(--primary); }
        
        /* Loader */
        .loader-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #020617; z-index: 50; display: flex; flex-direction: column; justify-content: center; items-center; transition: opacity 0.5s; }
        .nozzle { width: 20px; height: 40px; background: #94a3b8; position: absolute; top: 30%; left: 50%; transform: translateX(-50%); animation: moveNozzle 2s ease-in-out infinite; }
        .bed { width: 100px; height: 10px; background: #334155; position: absolute; top: 60%; left: 50%; transform: translateX(-50%); border-radius: 2px; }
        .print-object { width: 0; height: 0; background: var(--primary); position: absolute; bottom: 40%; left: 50%; transform: translateX(-50%); box-shadow: 0 0 10px var(--primary); animation: printGrow 2s linear infinite; }
        @keyframes moveNozzle { 0%, 100% { left: 40%; top: 30%; } 50% { left: 60%; top: 30%; } }
        @keyframes printGrow { 0% { width: 0; height: 0; opacity: 0.5; } 50% { width: 40px; height: 20px; opacity: 1; } 100% { width: 60px; height: 40px; opacity: 1; } }

        /* G-Code Progress Bar (Idea 4) */
        .gcode-progress-container { position: relative; height: 8px; background: #334155; border-radius: 4px; overflow: visible; }
        .gcode-progress-fill { height: 100%; background: var(--primary); border-radius: 4px; position: relative; transition: width 1s ease-in-out; box-shadow: 0 0 8px var(--primary); }
        .gcode-nozzle-tip {
            position: absolute; top: -6px; right: -4px; width: 8px; height: 12px; background: #94a3b8;
            clip-path: polygon(20% 0%, 80% 0%, 100% 70%, 50% 100%, 0% 70%);
            z-index: 10; transition: right 1s ease-in-out;
        }

        /* Scrollbar & Inputs */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2rem; appearance: none; }
        .product-card-img { mask-image: linear-gradient(to bottom, black 60%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, black 60%, transparent 100%); }
        .label-fixed { font-size: 9px; color: #94a3b8; font-weight: bold; display: block; margin-bottom: 2px; text-transform: uppercase; }

        /* Print Label */
        @media print {
            body * { visibility: hidden; }
            #print-area, #print-area * { visibility: visible; }
            #print-area { position: absolute; left: 0; top: 0; width: 100%; height: 100%; background: white; color: black; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- COMPONENTES VISUALES (Idea 1 & 4) ---
        
        // Tilt Card Component (Idea 1)
        const TiltCard = ({ children, className }) => {
            const cardRef = useRef(null);
            const [transform, setTransform] = useState('');

            const handleMove = (e) => {
                const card = cardRef.current;
                if(!card) return;
                const { left, top, width, height } = card.getBoundingClientRect();
                const x = (e.clientX - left) / width - 0.5;
                const y = (e.clientY - top) / height - 0.5;
                // Limitar rotaci贸n para que no sea exagerada
                setTransform(`perspective(1000px) rotateY(${x * 10}deg) rotateX(${-y * 10}deg) scale3d(1.02, 1.02, 1.02)`);
            };

            const handleLeave = () => setTransform('perspective(1000px) rotateY(0) rotateX(0) scale3d(1, 1, 1)');

            // Mobile Gyroscope parallax support would go here, kept simple for mouse/touch move
            return (
                <div 
                    ref={cardRef}
                    onMouseMove={handleMove}
                    onMouseLeave={handleLeave}
                    className={`transition-transform duration-100 ease-out transform-gpu ${className}`}
                    style={{ transform, transformStyle: 'preserve-3d' }}
                >
                    {children}
                    {/* Efecto de brillo */}
                    <div className="absolute inset-0 bg-gradient-to-tr from-white/5 to-transparent opacity-0 hover:opacity-100 transition-opacity pointer-events-none rounded-xl"></div>
                </div>
            );
        };

        // G-Code Progress Bar (Idea 4)
        const GCodeProgress = ({ percent, color = 'bg-theme' }) => {
            return (
                <div className="gcode-progress-container w-full mt-1">
                    <div className={`gcode-progress-fill ${color}`} style={{ width: `${percent}%` }}>
                        <div className="gcode-nozzle-tip"></div>
                    </div>
                </div>
            );
        };

        // --- ICONOS ---
        const Icons = {
            Printer: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9V2h12v7"></path><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><path d="M6 14h12v8H6z"></path></svg>,
            Calc: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="4" y="2" width="16" height="20" rx="2"></rect><path d="M8 6h8"></path><path d="M8 10h8"></path><path d="M8 14h8"></path><path d="M8 18h8"></path></svg>,
            Box: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path></svg>,
            Alert: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
            Trash: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Mic: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>,
            Moon: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>,
            History: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 20v-6M6 20V10M18 20V4"></path></svg>,
            Stats: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>,
            Config: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Calendar: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            Catalog: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>,
            Edit: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            Plus: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Palette: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path></svg>,
            Tag: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line></svg>,
            Cloud: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>,
            X: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        const DEFAULT_MATERIALS = [
            { id: 1, name: "PLA", cost: 300, weight: 1000, icon: "" },
            { id: 2, name: "PETG", cost: 350, weight: 1000, icon: "イ" },
            { id: 3, name: "ABS", cost: 320, weight: 1000, icon: "П" },
            { id: 4, name: "TPU", cost: 480, weight: 1000, icon: "" },
            { id: 5, name: "Resina", cost: 600, weight: 1000, icon: "" }
        ];

        function App() {
            const [view, setView] = useState('calculator');
            const [loading, setLoading] = useState(true);
            const [oledMode, setOledMode] = useState(false);
            const [listening, setListening] = useState(false);
            
            // Data & Config
            const [config, setConfig] = useState({
                monthlyGoal: 12000, dailyHours: 16, daysPerMonth: 24, kwhCost: 3.5, maintenanceCost: 5, laborHourlyRate: 100, failureMargin: 10, resinCleaningCost: 15,
                printers: [{ id: 1, name: "Ender 3", watts: 350, price: 5000 }]
            });
            const [inventory, setInventory] = useState([]);
            const [history, setHistory] = useState([]);
            const [cart, setCart] = useState([]);
            const [catalog, setCatalog] = useState([]);

            // Forms
            const [printData, setPrintData] = useState({ pieceName: '', hours: 4, minutes: 0, grams: 100, postProcessingMin: 0, selectedMaterialId: 1, selectedInventoryId: '', selectedPrinterId: 1, quantity: 1, shippingCost: 0, isMultiColor: false, extraFilaments: [] });
            const [invForm, setInvForm] = useState({ matId: 1, color: '', rollCost: 300, initialWeight: 1000, currentWeight: 1000, count: 1 });
            const [editingInvId, setEditingInvId] = useState(null);
            const [manualProd, setManualProd] = useState({ name: '', grams: 0, hours: 0, minutes: 0, image: null });
            const [manualFormOpen, setManualFormOpen] = useState(false);
            const [newPrinter, setNewPrinter] = useState({ name: '', watts: 350, price: 0 });
            const [editingPrinterId, setEditingPrinterId] = useState(null);
            const [labelData, setLabelData] = useState(null);
            const [zoomImage, setZoomImage] = useState(null);
            const fileInputRef = useRef(null);

            // --- INIT & STORAGE ---
            useEffect(() => {
                const load = (k) => { try { return JSON.parse(localStorage.getItem(k)); } catch(e){ return null; } };
                const c = load('bp15_config'); if(c) setConfig(c);
                const i = load('bp15_inventory'); if(i) setInventory(i);
                const h = load('bp15_history'); if(h) setHistory(h);
                const cat = load('bp15_catalog'); if(cat) setCatalog(cat);

                const month = new Date().getMonth();
                if (month === 9) document.body.classList.add('theme-halloween');
                else if (month === 11) document.body.classList.add('theme-christmas');

                setTimeout(() => setLoading(false), 1500);
            }, []);

            useEffect(() => {
                localStorage.setItem('bp15_config', JSON.stringify(config));
                localStorage.setItem('bp15_inventory', JSON.stringify(inventory));
                localStorage.setItem('bp15_history', JSON.stringify(history));
                localStorage.setItem('bp15_catalog', JSON.stringify(catalog));
                if (oledMode) document.body.classList.add('theme-oled'); else document.body.classList.remove('theme-oled');
            }, [config, inventory, history, catalog, oledMode]);

            // --- HELPER: HAPTICS (Idea 5) ---
            const triggerHaptic = () => {
                if (navigator.vibrate) navigator.vibrate(50);
            };

            // --- CALCULATIONS ---
            const parseVal = (v) => parseFloat(v) || 0;
            const activePrinters = config.printers.length || 1;
            const monthlyHours = parseVal(config.dailyHours) * parseVal(config.daysPerMonth);
            const goalPerPrinter = parseVal(config.monthlyGoal) / activePrinters;
            const hourlyProfitTarget = monthlyHours > 0 ? goalPerPrinter / monthlyHours : 0;

            const selectedPrinter = config.printers.find(p => p.id == printData.selectedPrinterId) || config.printers[0] || {watts: 350, name: 'Default'};
            const electricityCostPerHour = (parseVal(selectedPrinter.watts) / 1000) * parseVal(config.kwhCost);
            
            const calculateSingleItem = (data) => {
                const selectedMatType = DEFAULT_MATERIALS.find(m => m.id == data.selectedMaterialId) || DEFAULT_MATERIALS[0];
                const selectedRoll = inventory.find(i => i.id == data.selectedInventoryId);
                const costPerGram = selectedRoll ? (parseVal(selectedRoll.rollCost) / parseVal(selectedRoll.initialWeight)) : (selectedMatType.cost / selectedMatType.weight);
                
                let materialCost = parseVal(data.grams) * costPerGram;
                let totalGrams = parseVal(data.grams);

                if(data.isMultiColor && data.extraFilaments) {
                    data.extraFilaments.forEach(fil => {
                        const extraRoll = inventory.find(i => i.id == fil.invId);
                        if (extraRoll) {
                            const extraCostPerGram = (parseVal(extraRoll.rollCost) / parseVal(extraRoll.initialWeight));
                            materialCost += parseVal(fil.grams) * extraCostPerGram;
                            totalGrams += parseVal(fil.grams);
                        }
                    });
                }

                const timeHours = parseVal(data.hours) + (parseVal(data.minutes) / 60);
                const electricity = timeHours * electricityCostPerHour;
                const maintenance = timeHours * parseVal(config.maintenanceCost);
                const machineProfit = timeHours * hourlyProfitTarget; 
                const laborCost = (parseVal(data.postProcessingMin) / 60) * parseVal(config.laborHourlyRate);
                const isResin = selectedMatType.name.toLowerCase().includes('resina');
                const resinCleanCost = isResin ? parseVal(config.resinCleaningCost) : 0;

                const subtotal = materialCost + electricity + maintenance + machineProfit + laborCost + resinCleanCost;
                const margin = subtotal * (parseVal(config.failureMargin) / 100);
                const shipping = parseVal(data.shippingCost);
                const unitTotal = subtotal + margin;
                const qty = parseVal(data.quantity) || 1;

                let stockAlert = null;
                if (selectedRoll && parseVal(selectedRoll.currentWeight) < (parseVal(data.grams) * qty)) {
                    stockAlert = { deficit: (parseVal(data.grams) * qty) - parseVal(selectedRoll.currentWeight) };
                }

                const totalTimeHours = timeHours * qty;
                const dailyHours = parseVal(config.dailyHours) || 1;
                const daysToFinish = (totalTimeHours / dailyHours).toFixed(1);

                return {
                    unitPrice: unitTotal,
                    totalPrice: (unitTotal * qty) + shipping,
                    totalGrams: totalGrams * qty,
                    totalTimeHours: totalTimeHours,
                    daysToFinish: daysToFinish,
                    breakdown: { mat: materialCost * qty, elec: electricity * qty, maint: maintenance * qty, labor: laborCost * qty, profit: (machineProfit * qty) + (margin * qty) + (laborCost * qty) },
                    stockAlert,
                    totalRollsForJob: Math.ceil((totalGrams * qty) / 1000)
                };
            };
            const result = calculateSingleItem(printData);

            // --- ACTIONS ---
            const addToCart = () => {
                if (!printData.pieceName) return alert("Falta nombre");
                triggerHaptic(); // Haptic Feedback
                setCart([...cart, { ...printData, result }]);
                setPrintData({...printData, pieceName: '', quantity: 1, isMultiColor: false, extraFilaments: []});
            };

            const confirmSale = () => {
                triggerHaptic(); // Haptic Feedback
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#06b6d4', '#9333ea', '#ffffff'] });
                
                const newInv = [...inventory];
                const deduct = (id, amount) => {
                    const idx = newInv.findIndex(i => i.id == id);
                    if(idx >= 0) newInv[idx].currentWeight = Math.max(0, newInv[idx].currentWeight - amount);
                };

                cart.forEach(item => {
                    const qty = parseVal(item.quantity) || 1;
                    if (item.selectedInventoryId) {
                        deduct(item.selectedInventoryId, parseVal(item.grams) * qty);
                    }
                    if (item.isMultiColor && item.extraFilaments) {
                        item.extraFilaments.forEach(fil => {
                            if(fil.invId) deduct(fil.invId, parseVal(fil.grams) * qty);
                        });
                    }
                });
                setInventory(newInv);

                const printersUsage = cart.map(item => ({ printerId: item.selectedPrinterId, net: item.result.breakdown.profit }));
                const saleRecord = { id: Date.now(), date: new Date().toISOString(), items: cart, total: cart.reduce((a,b) => a + b.result.totalPrice, 0), printersUsage };
                setHistory([saleRecord, ...history]);
                setCart([]);
            };

            const saveInventory = () => {
                if(!invForm.color) return;
                if (editingInvId) { setInventory(inventory.map(i => i.id === editingInvId ? { ...i, ...invForm } : i)); setEditingInvId(null); } 
                else { setInventory([...inventory, {id: Date.now(), ...invForm}]); }
                setInvForm({ matId: 1, color: '', rollCost: 300, initialWeight: 1000, currentWeight: 1000, count: 1 });
            };
            const editInventory = (item) => { setInvForm(item); setEditingInvId(item.id); };

            const addPrinter = () => {
                if(!newPrinter.name) return;
                if (editingPrinterId) { setConfig({ ...config, printers: config.printers.map(p => p.id === editingPrinterId ? { ...newPrinter, id: editingPrinterId } : p) }); setEditingPrinterId(null); } 
                else { setConfig({...config, printers: [...(config.printers || []), { ...newPrinter, id: Date.now() }]}); }
                setNewPrinter({ name: '', watts: 350, price: 0 });
            };
            const deletePrinter = (id) => { if(config.printers.length <= 1) return alert("M铆nimo 1"); setConfig({...config, printers: config.printers.filter(p => p.id !== id)}); };

            const handleVoice = () => {
                if (!('webkitSpeechRecognition' in window)) return alert("No soporta voz");
                const r = new webkitSpeechRecognition();
                r.lang = 'es-ES';
                r.onstart = () => setListening(true);
                r.onend = () => setListening(false);
                r.onresult = (e) => setPrintData({...printData, pieceName: e.results[0][0].transcript});
                r.start();
            };

            const handleManualImage = (e) => { if(e.target.files[0]){ const r = new FileReader(); r.onload = (ev) => setManualProd({...manualProd, image: ev.target.result}); r.readAsDataURL(e.target.files[0]); }};
            const saveManualToCatalog = () => { if(!manualProd.name) return; setCatalog([...catalog, { id: Date.now(), name: manualProd.name, image: manualProd.image, data: { grams: manualProd.grams, hours: manualProd.hours, minutes: manualProd.minutes, pieceName: manualProd.name } }]); setManualFormOpen(false); };
            const loadFromCatalog = (item) => { setPrintData(prev => ({ ...prev, ...item.data })); setView('calculator'); };

            const calculateStats = () => {
                let printerROI = {};
                let grandTotalNet = 0;
                config.printers.forEach(p => printerROI[p.id] = { net: 0, name: p.name, cost: p.price });
                history.forEach(sale => { 
                    if(sale.printersUsage) sale.printersUsage.forEach(usage => { 
                        if(printerROI[usage.printerId]) {
                            printerROI[usage.printerId].net += usage.net; 
                            grandTotalNet += usage.net;
                        }
                    }); 
                });
                return { printerROI, grandTotalNet };
            };
            const stats = calculateStats();
            const progressPercent = Math.min((stats.grandTotalNet / parseVal(config.monthlyGoal)) * 100, 100); // Simple goal tracking using net profit for progress bar logic

            const addExtraFilament = () => setPrintData(prev => ({ ...prev, extraFilaments: [...(prev.extraFilaments || []), { invId: '', grams: 0 }] }));
            const updateExtraFilament = (idx, field, val) => { const n = [...printData.extraFilaments]; n[idx][field] = val; setPrintData(prev => ({ ...prev, extraFilaments: n })); };
            const removeExtraFilament = (idx) => {
                const newExtras = printData.extraFilaments.filter((_, i) => i !== idx);
                setPrintData(prev => ({ ...prev, extraFilaments: newExtras }));
            };

            if (loading) return <div className="loader-container"><div className="nozzle"></div><div className="print-object"></div><div className="bed"></div><div className="text-cyan-500 font-cyber mt-32 animate-pulse">TITANIUM EDITION...</div></div>;

            return (
                <div className="min-h-screen pb-10 px-4 pt-4 flex flex-col items-center">
                    {zoomImage && <div className="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4" onClick={() => setZoomImage(null)}><img src={zoomImage} className="max-w-full max-h-full rounded border-2 border-cyan-500"/></div>}
                    {labelData && <div id="print-area" className="hidden p-4 border-2 border-black font-mono text-xs w-64 visible-print">
                        <div className="text-center font-bold text-lg mb-2">BUDPRO 3D</div><div className="border-b border-black mb-2"></div>
                        <div className="mb-2">Fecha: {new Date(labelData.date).toLocaleDateString()}</div>
                        {labelData.items.map((item, idx) => (<div key={idx} className="flex justify-between mb-1"><span>{item.quantity}x {item.pieceName}</span><span>${item.result.unitPrice.toFixed(0)}</span></div>))}
                        <div className="border-b border-black my-2"></div>
                        <div className="flex justify-between font-bold text-sm"><span>TOTAL:</span><span>${labelData.total.toFixed(2)}</span></div>
                    </div>}

                    <div className="w-full max-w-md mb-4 flex justify-between items-center bg-opacity-50 bg-gray-900 p-3 rounded-xl border border-gray-700 backdrop-blur-sm">
                        <div>
                            <h1 className="text-xl font-cyber text-theme tracking-widest flex items-center gap-2">
                                <Icons.Printer/> BUDPRO <span className="text-[10px] bg-cyan-900 text-cyan-200 px-1 rounded">TITANIUM</span>
                            </h1>
                            <div className="text-[10px] text-gray-400 mt-1 flex items-center gap-1"><Icons.Calendar/> {new Date().toLocaleDateString()}</div>
                        </div>
                        <div className="text-right">
                            <div className="w-24 h-2 bg-gray-800 rounded-full relative overflow-hidden mb-1">
                                <GCodeProgress percent={progressPercent} />
                            </div>
                            <div className="text-[9px] text-green-400">${stats.grandTotalNet.toFixed(0)} / ${config.monthlyGoal}</div>
                        </div>
                        <button onClick={() => setOledMode(!oledMode)} className={`p-2 rounded-full ${oledMode ? 'text-yellow-400' : 'text-gray-400'}`}><Icons.Moon/></button>
                    </div>

                    <div className="w-full max-w-md grid grid-cols-6 gap-1 mb-4">
                        {[{id:'calculator', i:<Icons.Calc/>}, {id:'inventory', i:<Icons.Box/>}, {id:'catalog', i:<Icons.Catalog/>}, {id:'stats', i:<Icons.Stats/>}, {id:'history', i:<Icons.History/>}, {id:'config', i:<Icons.Config/>}].map(btn => (
                            <button key={btn.id} onClick={() => setView(btn.id)} className={`p-2 rounded flex justify-center items-center ${view === btn.id ? 'bg-theme text-white' : 'bg-gray-800 text-gray-400'}`}>{btn.i}</button>
                        ))}
                    </div>

                    {view === 'calculator' && (
                        <div className="w-full max-w-md space-y-4 animate-fade-in">
                            <TiltCard className="bg-gray-800 border border-gray-700 rounded-xl p-5 relative">
                                <div className="flex justify-between items-end mb-2"><span className="text-xs text-gray-400 font-bold">COTIZACIN</span><span className="text-4xl font-cyber text-white neon-text">${result.totalPrice.toFixed(2)}</span></div>
                                <div className="grid grid-cols-2 gap-2 text-[10px] font-mono border-t border-gray-700 pt-3 mt-2">
                                    <div className="flex justify-between"><span>Material:</span><span className="text-gray-300">${result.breakdown.mat.toFixed(2)}</span></div>
                                    <div className="flex justify-between"><span>Luz:</span><span className="text-gray-300">${result.breakdown.elec.toFixed(2)}</span></div>
                                    <div className="flex justify-between"><span>Mano Obra:</span><span className="text-gray-300">${result.breakdown.labor.toFixed(2)}</span></div>
                                    <div className="flex justify-between"><span>Depreciaci贸n:</span><span className="text-gray-300">${result.breakdown.maint.toFixed(2)}</span></div>
                                    <div className="flex justify-between col-span-2 text-green-400 font-bold border-t border-gray-700 pt-1 mt-1"><span>GANANCIA NETA:</span><span>${result.breakdown.profit.toFixed(2)}</span></div>
                                </div>
                                <div className="border-t border-gray-700 mt-2 pt-2 text-[10px] text-gray-400 text-right">
                                    Tiempo Total: <span className="text-white font-bold">{result.totalTimeHours.toFixed(1)}h</span> 
                                    <span className="text-gray-500"> ({result.daysToFinish} d铆as de {config.dailyHours}h)</span>
                                </div>
                                {result.stockAlert && <div className="mt-2 bg-red-900/50 text-red-200 p-2 rounded flex items-center gap-2 text-xs animate-pulse border border-red-500"><Icons.Alert/> Falta material ({result.stockAlert.deficit}g)</div>}
                            </TiltCard>

                            <div className="space-y-3">
                                <div className="flex gap-2">
                                    <div className="flex-1 relative">
                                        <label className="label-fixed">NOMBRE PIEZA</label>
                                        <input value={printData.pieceName} onChange={e => setPrintData({...printData, pieceName: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white" />
                                        <button onClick={handleVoice} className={`absolute right-2 top-7 ${listening ? 'text-red-500 animate-pulse' : 'text-gray-400'}`}><Icons.Mic/></button>
                                    </div>
                                    <div className="w-16">
                                        <label className="label-fixed">CANT</label>
                                        <input type="number" value={printData.quantity} onChange={e => setPrintData({...printData, quantity: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white text-center" />
                                    </div>
                                </div>

                                <div>
                                    <label className="label-fixed">MATERIAL</label>
                                    <select value={printData.selectedMaterialId} onChange={e => setPrintData({...printData, selectedMaterialId: e.target.value, selectedInventoryId: ''})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white text-xs">
                                        {DEFAULT_MATERIALS.map(m => <option key={m.id} value={m.id}>{m.icon} {m.name}</option>)}
                                    </select>
                                </div>

                                {/* Visual Stock Selector (Idea 9) */}
                                <div>
                                    <label className="label-fixed">STOCK DISPONIBLE</label>
                                    <div className="flex overflow-x-auto gap-2 pb-2">
                                        {inventory.filter(i => i.matId == printData.selectedMaterialId).length === 0 && <div className="text-xs text-gray-500 p-2">No hay stock</div>}
                                        {inventory.filter(i => i.matId == printData.selectedMaterialId).map(i => (
                                            <div 
                                                key={i.id} 
                                                onClick={() => setPrintData({...printData, selectedInventoryId: i.id})}
                                                className={`flex-shrink-0 p-2 rounded border cursor-pointer min-w-[80px] text-center transition-all ${printData.selectedInventoryId == i.id ? 'border-theme bg-gray-700' : 'border-gray-600 bg-gray-800'}`}
                                            >
                                                <div className="text-xs font-bold text-white truncate">{i.color}</div>
                                                <div className="text-[10px] text-gray-400">{i.currentWeight}g</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <div className="bg-gray-800 p-2 rounded border border-gray-700">
                                    <div className="flex justify-between items-center mb-2"><label className="label-fixed text-white">MULTI-MATERIAL (EXTRAS)</label><button onClick={() => setPrintData({...printData, isMultiColor: !printData.isMultiColor})} className={`text-[10px] px-2 rounded ${printData.isMultiColor ? 'bg-theme text-white' : 'bg-gray-700 text-gray-400'}`}><Icons.Palette/></button></div>
                                    {printData.isMultiColor && (
                                        <div className="space-y-2">
                                            {printData.extraFilaments.map((fil, idx) => (
                                                <div key={idx} className="flex gap-2 items-center">
                                                    <div className="flex-1">
                                                        <select value={fil.invId} onChange={(e) => updateExtraFilament(idx, 'invId', e.target.value)} className="w-full bg-gray-900 border-gray-600 rounded text-xs text-white p-1">
                                                            <option value="">Rollo...</option>
                                                            {inventory.map(inv => {
                                                                const mat = DEFAULT_MATERIALS.find(m => m.id == inv.matId);
                                                                return <option key={inv.id} value={inv.id}>{mat.icon} {mat.name} - {inv.color} ({inv.currentWeight}g)</option>
                                                            })}
                                                        </select>
                                                    </div>
                                                    <input type="number" placeholder="g" value={fil.grams} onChange={(e) => updateExtraFilament(idx, 'grams', e.target.value)} className="w-16 bg-gray-900 border-gray-600 rounded text-xs text-white p-1"/>
                                                    <button onClick={() => removeExtraFilament(idx)} className="text-red-400"><Icons.X/></button>
                                                </div>
                                            ))}
                                            <button onClick={addExtraFilament} className="text-[10px] text-theme">+ Agregar Filamento</button>
                                        </div>
                                    )}
                                </div>

                                <div className="grid grid-cols-3 gap-3">
                                    <div><label className="label-fixed">GRAMOS</label><input type="number" value={printData.grams} onChange={e => setPrintData({...printData, grams: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white" /></div>
                                    <div><label className="label-fixed">HORAS</label><input type="number" value={printData.hours} onChange={e => setPrintData({...printData, hours: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white" /></div>
                                    <div><label className="label-fixed">MIN</label><input type="number" value={printData.minutes} onChange={e => setPrintData({...printData, minutes: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white" /></div>
                                </div>
                                
                                <div className="grid grid-cols-2 gap-3">
                                    <div><label className="label-fixed">POST-PROCESO (MIN)</label><input type="number" value={printData.postProcessingMin} onChange={e => setPrintData({...printData, postProcessingMin: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white" /></div>
                                    <div><label className="label-fixed">ENVO ($)</label><input type="number" value={printData.shippingCost} onChange={e => setPrintData({...printData, shippingCost: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white" /></div>
                                </div>

                                <div><label className="label-fixed">IMPRESORA</label><select value={printData.selectedPrinterId} onChange={e => setPrintData({...printData, selectedPrinterId: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-3 text-white text-xs">{config.printers.map(p => <option key={p.id} value={p.id}>{p.name} ({p.watts}W)</option>)}</select></div>
                                <button onClick={addToCart} className="w-full bg-theme hover:opacity-80 text-white font-bold py-3 rounded-lg shadow-lg transform active:scale-95 transition-transform">AGREGAR AL CARRITO</button>
                            </div>

                            {cart.length > 0 && (
                                <div className="bg-gray-900 border border-gray-700 rounded-xl p-4">
                                    <h3 className="text-xs text-gray-400 font-bold mb-2">EN COLA ({cart.length})</h3>
                                    {cart.map((item, idx) => (<div key={idx} className="flex justify-between text-sm text-white mb-1"><span>{item.quantity}x {item.pieceName}</span><span className="text-theme">${item.result.totalPrice.toFixed(0)}</span></div>))}
                                    <button onClick={confirmSale} className="w-full mt-2 bg-green-600 text-white py-2 rounded font-bold text-xs transform active:scale-95 transition-transform">CONFIRMAR VENTA </button>
                                </div>
                            )}
                        </div>
                    )}

                    {/* INVENTORY */}
                    {view === 'inventory' && (
                        <div className="w-full max-w-md space-y-4 animate-fade-in">
                            <TiltCard className={`bg-blue-900/10 border p-4 rounded-xl ${editingInvId ? 'border-yellow-500' : 'border-blue-500/30'}`}>
                                <h3 className={`${editingInvId ? 'text-yellow-400' : 'text-blue-400'} font-bold text-xs mb-2 flex items-center gap-2`}><Icons.Plus/> {editingInvId ? 'EDITAR' : 'NUEVO'}</h3>
                                <div className="grid grid-cols-2 gap-2 mb-2">
                                    <div className="col-span-2"><label className="label-fixed">MATERIAL</label><select value={invForm.matId} onChange={e => setInvForm({...invForm, matId: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-xs">{DEFAULT_MATERIALS.map(m => <option key={m.id} value={m.id}>{m.icon} {m.name}</option>)}</select></div>
                                    <div><label className="label-fixed">COLOR</label><input value={invForm.color} onChange={e => setInvForm({...invForm, color: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-xs" /></div>
                                    <div><label className="label-fixed">COSTO ($)</label><input type="number" value={invForm.rollCost} onChange={e => setInvForm({...invForm, rollCost: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-xs" /></div>
                                    <div className="col-span-2 grid grid-cols-2 gap-2">
                                        <div><label className="label-fixed">PESO INICIAL</label><input type="number" value={invForm.initialWeight} onChange={e => setInvForm({...invForm, initialWeight: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-xs" /></div>
                                        <div><label className="label-fixed">QUEDA</label><input type="number" value={invForm.currentWeight} onChange={e => setInvForm({...invForm, currentWeight: e.target.value})} className="w-full bg-gray-800 border border-gray-600 rounded p-2 text-white text-xs" /></div>
                                    </div>
                                </div>
                                <button onClick={saveInventory} className={`w-full text-white py-2 rounded text-xs font-bold ${editingInvId ? 'bg-yellow-600' : 'bg-blue-600'}`}>{editingInvId ? 'ACTUALIZAR' : 'GUARDAR'}</button>
                                {editingInvId && <button onClick={() => {setEditingInvId(null); setInvForm({ matId: 1, color: '', rollCost: 300, initialWeight: 1000, currentWeight: 1000, count: 1 })}} className="w-full text-red-400 text-xs mt-1">Cancelar</button>}
                            </TiltCard>
                            <div className="space-y-2">{inventory.map(item => (<div key={item.id} className="bg-gray-800 p-3 rounded border-l-4 border-blue-500 flex justify-between items-center"><div><div className="font-bold text-sm text-white">{DEFAULT_MATERIALS.find(m=>m.id==item.matId)?.icon} {item.color}</div><div className="text-xs text-gray-400">{item.currentWeight}g / {item.initialWeight}g</div></div><div className="flex gap-2"><button onClick={()=>editInventory(item)} className="text-yellow-400"><Icons.Edit/></button><button onClick={()=>setInventory(inventory.filter(i=>i.id!==item.id))} className="text-red-400"><Icons.Trash/></button></div></div>))}</div>
                        </div>
                    )}

                    {/* STATS */}
                    {view === 'stats' && (
                        <div className="w-full max-w-md space-y-4 animate-fade-in">
                            <h2 className="text-center text-theme font-cyber mb-4">ROI (GANANCIA NETA)</h2>
                            {config.printers.map((p, idx) => {
                                const netProfit = stats.printerROI[p.id] ? stats.printerROI[p.id].net : 0;
                                const roiPercent = p.price > 0 ? Math.min((netProfit / p.price) * 100, 100) : 100;
                                return (
                                    <TiltCard key={idx} className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                                        <div className="flex justify-between text-sm text-white mb-2"><span className="font-bold">{p.name}</span><span className="text-green-400">${netProfit.toFixed(0)} / ${p.price}</span></div>
                                        <div className="w-full h-3 bg-gray-900 rounded-full overflow-hidden relative">
                                            <GCodeProgress percent={roiPercent} color="bg-gradient-to-r from-purple-500 to-cyan-500"/>
                                        </div>
                                        <div className="text-[10px] text-gray-500 mt-1 text-center">{roiPercent >= 100 ? '隆PAGADA!' : `Faltan $${(p.price - netProfit).toFixed(0)}`}</div>
                                    </TiltCard>
                                )
                            })}
                            <TiltCard className="bg-gray-900 p-4 rounded-xl border border-green-500/30 text-center mt-4">
                                <div className="text-xs text-gray-400 font-bold mb-1">ROI NETO TOTAL (TODAS LAS MQUINAS)</div>
                                <div className="text-3xl font-cyber text-green-400 neon-text">${stats.grandTotalNet.toFixed(0)}</div>
                                <div className="text-[10px] text-gray-500 mt-1">Ganancia neta acumulada hist贸rica</div>
                            </TiltCard>
                        </div>
                    )}

                    {/* HISTORY */}
                    {view === 'history' && (
                        <div className="w-full max-w-md space-y-4 animate-fade-in">
                            <h2 className="text-center text-theme font-cyber mb-4">VENTAS</h2>
                            {history.map(item => (
                                <div key={item.id} className="bg-gray-800 p-3 rounded border-l-2 border-theme">
                                    <div className="flex justify-between items-center"><div className="text-xs text-gray-400">{new Date(item.date).toLocaleDateString()}</div><div className="text-green-400 font-bold">${item.total.toFixed(0)}</div></div>
                                    <div className="text-sm text-white font-bold my-1">{item.items.length} Items</div>
                                    <button onClick={() => {setLabelData(item); setTimeout(()=>window.print(),500);}} className="w-full bg-gray-700 text-gray-300 text-xs py-1 rounded mt-2 flex items-center justify-center gap-2"><Icons.Tag/> ETIQUETA</button>
                                </div>
                            ))}
                        </div>
                    )}

                    {/* CATALOG */}
                    {view === 'catalog' && (
                        <div className="w-full max-w-md space-y-4 animate-fade-in">
                            <button onClick={() => setManualFormOpen(!manualFormOpen)} className="w-full bg-purple-600 text-white p-2 rounded font-bold text-xs flex justify-center gap-2 items-center"><Icons.Plus/> NUEVO MANUAL</button>
                            {manualFormOpen && (
                                <div className="bg-gray-800 p-3 rounded border border-purple-500 text-xs space-y-2">
                                    <div><label className="label-fixed">NOMBRE</label><input value={manualProd.name} onChange={e => setManualProd({...manualProd, name: e.target.value})} className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"/></div>
                                    <div className="grid grid-cols-3 gap-2">
                                        <div><label className="label-fixed">PESO</label><input type="number" value={manualProd.grams} onChange={e => setManualProd({...manualProd, grams: e.target.value})} className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"/></div>
                                        <div><label className="label-fixed">HRS</label><input type="number" value={manualProd.hours} onChange={e => setManualProd({...manualProd, hours: e.target.value})} className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"/></div>
                                        <div><label className="label-fixed">MIN</label><input type="number" value={manualProd.minutes} onChange={e => setManualProd({...manualProd, minutes: e.target.value})} className="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white"/></div>
                                    </div>
                                    <div className="flex gap-2"><input type="file" ref={fileInputRef} className="hidden" accept="image/*" onChange={handleManualImage}/><button onClick={() => fileInputRef.current.click()} className="bg-gray-700 text-white p-2 rounded flex-1">Subir Foto</button></div>
                                    <button onClick={saveManualToCatalog} className="w-full bg-green-600 text-white p-2 rounded font-bold">GUARDAR</button>
                                </div>
                            )}
                            <div className="grid grid-cols-2 gap-3">
                                {catalog.map(item => (
                                    <TiltCard key={item.id} className="bg-gray-800 border border-gray-700 rounded cursor-pointer relative overflow-hidden h-32">
                                        <div onClick={() => loadFromCatalog(item)} className="w-full h-full">
                                            {item.image && <img src={item.image} className="absolute inset-0 w-full h-full object-cover opacity-60 product-card-img" onClick={(e) => {e.stopPropagation(); setZoomImage(item.image)}}/>}
                                            <div className="absolute bottom-0 left-0 w-full p-2 bg-gradient-to-t from-black"><div className="font-bold text-white text-sm truncate">{item.name}</div></div>
                                        </div>
                                    </TiltCard>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* CONFIG */}
                    {view === 'config' && (
                        <div className="w-full max-w-md space-y-4 animate-fade-in">
                            <div className="bg-gray-800 p-3 rounded border border-gray-700">
                                <h3 className="text-xs text-gray-300 font-bold mb-2">FLOTA</h3>
                                <div className="space-y-2 mb-3">
                                    {config.printers.map(p => (
                                        <div key={p.id} className="flex justify-between items-center bg-gray-900 p-2 rounded text-xs text-white">
                                            <span>{p.name} ({p.watts}W)</span>
                                            <div className="flex gap-2">
                                                <button onClick={() => {setNewPrinter({name: p.name, watts: p.watts, price: p.price}); setEditingPrinterId(p.id)}} className="text-yellow-400"><Icons.Edit/></button>
                                                <button onClick={() => deletePrinter(p.id)} className="text-red-400"><Icons.Trash/></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="grid grid-cols-3 gap-1">
                                    <div><label className="label-fixed">NOMBRE</label><input value={newPrinter.name} onChange={e => setNewPrinter({...newPrinter, name: e.target.value})} className="bg-gray-700 w-full text-white p-1 rounded text-xs"/></div>
                                    <div><label className="label-fixed">WATTS</label><input type="number" value={newPrinter.watts} onChange={e => setNewPrinter({...newPrinter, watts: e.target.value})} className="bg-gray-700 w-full text-white p-1 rounded text-xs"/></div>
                                    <div><label className="label-fixed">PRECIO $</label><input type="number" value={newPrinter.price} onChange={e => setNewPrinter({...newPrinter, price: e.target.value})} className="bg-gray-700 w-full text-white p-1 rounded text-xs"/></div>
                                    <button onClick={addPrinter} className={`col-span-3 rounded text-xs font-bold py-1 mt-1 ${editingPrinterId ? 'bg-yellow-600' : 'bg-theme text-white'}`}>{editingPrinterId ? 'ACTUALIZAR' : 'AGREGAR'}</button>
                                </div>
                            </div>
                            <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                                <h3 className="text-xs font-bold text-gray-400 mb-2">FINANZAS</h3>
                                <div className="grid grid-cols-2 gap-2">
                                    <div><label className="label-fixed">META ($)</label><input type="number" value={config.monthlyGoal} onChange={e => setConfig({...config, monthlyGoal: e.target.value})} className="w-full bg-gray-900 p-2 text-white rounded text-xs"/></div>
                                    <div><label className="label-fixed">kWh ($)</label><input type="number" value={config.kwhCost} onChange={e => setConfig({...config, kwhCost: e.target.value})} className="w-full bg-gray-900 p-2 text-white rounded text-xs"/></div>
                                    <div><label className="label-fixed">HRS/DA</label><input type="number" value={config.dailyHours} onChange={e => setConfig({...config, dailyHours: e.target.value})} className="w-full bg-gray-900 p-2 text-white rounded text-xs"/></div>
                                    <div><label className="label-fixed">DAS/MES</label><input type="number" value={config.daysPerMonth} onChange={e => setConfig({...config, daysPerMonth: e.target.value})} className="w-full bg-gray-900 p-2 text-white rounded text-xs"/></div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

